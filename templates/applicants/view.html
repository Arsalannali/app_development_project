{% extends "base.html" %}

{% block title %}{{ applicant.first_name }} {{ applicant.last_name }} - Applicant Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3><i class="bi bi-user"></i> {{ applicant.first_name }} {{ applicant.last_name }}</h3>
                    <p class="mb-0">Applicant ID: {{ applicant.applicant_id }} â€¢ Applied for: {{ job.title }}</p>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6><i class="bi bi-envelope"></i> Email</h6>
                            <p>{{ applicant.email }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-phone"></i> Contact</h6>
                            <p>{{ applicant.contact }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-id-card"></i> CNIC</h6>
                            <p>{{ applicant.cnic }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-calendar"></i> Application Date</h6>
                            <p>{{ applicant.application_date }}</p>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-4">
                            <h6><i class="bi bi-briefcase"></i> Experience</h6>
                            <p>{{ applicant.experience_years }} years</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-building"></i> Current Company</h6>
                            <p>{{ applicant.current_company or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-dollar-sign"></i> Expected Salary</h6>
                            <p>
                                {% if applicant.expected_salary %}
                                    PKR {{ "{:,.0f}".format(applicant.expected_salary) }}
                                {% else %}
                                    Not specified
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    {% if applicant.cover_letter %}
                    <div class="mb-4">
                        <h6><i class="bi bi-file-alt"></i> Cover Letter</h6>
                        <div class="border p-3 bg-light">
                            {{ applicant.cover_letter|replace('\n', '<br>')|safe }}
                        </div>
                    </div>
                    {% endif %}

                    <div class="mb-4">
                        <h6><i class="bi bi-file-pdf"></i> Resume</h6>
                        {% if applicant.resume_filename %}
                        <div class="d-flex align-items-center">
                            <i class="bi bi-file-pdf text-danger me-2"></i>
                            <span class="me-3">{{ applicant.resume_filename }}</span>
                            <a href="{{ url_for('download_resume', filename=applicant.resume_filename) }}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-download"></i> Download
                            </a>
                        </div>
                        {% else %}
                        <p class="text-muted">No resume uploaded</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Status Update Form -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="bi bi-edit"></i> Update Application Status</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('applicant_update_status', applicant_id=applicant.applicant_id) }}">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="status" class="form-label">Status *</label>
                                    <select class="form-select" id="status" name="status" required>
                                        <option value="Applied" {{ 'selected' if applicant.status == 'Applied' else '' }}>Applied</option>
                                        <option value="Shortlisted" {{ 'selected' if applicant.status == 'Shortlisted' else '' }}>Shortlisted</option>
                                        <option value="Interviewed" {{ 'selected' if applicant.status == 'Interviewed' else '' }}>Interviewed</option>
                                        <option value="Hired" {{ 'selected' if applicant.status == 'Hired' else '' }}>Hired</option>
                                        <option value="Rejected" {{ 'selected' if applicant.status == 'Rejected' else '' }}>Rejected</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="interview_date" class="form-label">Interview Date</label>
                                    <input type="date" class="form-control" id="interview_date" name="interview_date" 
                                           value="{{ applicant.interview_date or '' }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" 
                                      placeholder="Add any notes about this applicant...">{{ applicant.notes or '' }}</textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Update Status
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Job Details Card -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-briefcase"></i> Job Details</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Position:</strong> {{ job.title }}
                    </div>
                    <div class="mb-3">
                        <strong>Department:</strong> {{ job.department }}
                    </div>
                    <div class="mb-3">
                        <strong>Location:</strong> {{ job.location }}
                    </div>
                    <div class="mb-3">
                        <strong>Type:</strong> {{ job.employment_type }}
                    </div>
                    <div class="mb-3">
                        <strong>Level:</strong> {{ job.experience_level }}
                    </div>
                    {% if job.salary_range %}
                    <div class="mb-3">
                        <strong>Salary Range:</strong> {{ job.salary_range }}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Application Status Card -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="bi bi-info-circle"></i> Application Status</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Current Status:</strong>
                        {% if applicant.status == 'Applied' %}
                            <span class="badge bg-primary">{{ applicant.status }}</span>
                        {% elif applicant.status == 'Shortlisted' %}
                            <span class="badge bg-info">{{ applicant.status }}</span>
                        {% elif applicant.status == 'Interviewed' %}
                            <span class="badge bg-warning">{{ applicant.status }}</span>
                        {% elif applicant.status == 'Hired' %}
                            <span class="badge bg-success">{{ applicant.status }}</span>
                        {% elif applicant.status == 'Rejected' %}
                            <span class="badge bg-danger">{{ applicant.status }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ applicant.status }}</span>
                        {% endif %}
                    </div>
                    
                    {% if applicant.review_date %}
                    <div class="mb-3">
                        <strong>Reviewed:</strong> {{ applicant.review_date }}
                    </div>
                    {% endif %}
                    
                    {% if applicant.interview_date %}
                    <div class="mb-3">
                        <strong>Interview Date:</strong> {{ applicant.interview_date }}
                    </div>
                    {% endif %}
                    
                    {% if applicant.notes %}
                    <div class="mb-3">
                        <strong>Notes:</strong>
                        <div class="border p-2 bg-light mt-1">
                            {{ applicant.notes|replace('\n', '<br>')|safe }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="bi bi-cog"></i> Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        {% if applicant.status in ['Shortlisted', 'Interviewed'] %}
                        <a href="{{ url_for('applicant_onboard', applicant_id=applicant.applicant_id) }}" 
                           class="btn btn-success">
                            <i class="bi bi-user-plus"></i> Onboard as Employee
                        </a>
                        {% endif %}
                        
                        <a href="{{ url_for('applicants_list') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Applicants
                        </a>
                        
                        {% if session.role == 'Admin' %}
                        <form method="POST" action="{{ url_for('applicant_delete', applicant_id=applicant.applicant_id) }}" 
                              onsubmit="return confirm('Are you sure you want to delete this applicant?')">
                            <button type="submit" class="btn btn-danger w-100">
                                <i class="bi bi-trash"></i> Delete Applicant
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
